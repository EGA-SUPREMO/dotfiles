#!/bin/bash
#
# download videos in 720p, 480p, etc. if availible
#  --write-sub --embed-subs  for subs meybe is importent
#  -o '%(title)s.%(ext)s'
dv() {
    if [ $# = '0' ]; then
        cat <<HELP_USAGE
Welcome to Yet Another Video Downloader!
USAGE:
    $0 <quality> <link or yt id> [localization] [extra]

    quality        The max quality of the video, e.g for 240 is 2, for 720 is 7, for 1080 is 10
    link or yt id  Link of the video or the id of the youtube video
    localization   Localization of the downloaded file, e.g. ~/home

    extra          Currently it only accepts two:
        w              For download the video with the worstaudio available
        mp4            Download video in MP4 format
HELP_USAGE
    else # Dont know how to exit program without closing tab
    case $1 in
        *"1"*)
            echo -n "144p selected, pls press Ctrl+C or wait 10 seconds" && sleep 10s &&
            QUALITY=144
            ;;
        *"2"*)
            QUALITY=240
            ;;
        *"3"*)
            QUALITY=360
            ;;
        *"4"*)
            QUALITY=480
            ;;
        *"7"*)
            QUALITY=720
            ;;
        *"10"*)
            QUALITY=1080
            ;;
        *)
            echo -n "${0}: Error invalid quality arg"
            ;;
    esac

    case $4 in
        *"mp4"*)
            FORMAT="bestvideo[ext=mp4][height<=${QUALITY}]+bestaudio[ext=m4a]/best=[ext=mp4][height<=${QUALITY}]"
            ;;
        *"w"*)
            if [[ $3 = 'm' ]]; then
                echo -n "are you sure you want to download a music with worstaudio? press Ctrl+C or wait 10 seconds" && sleep 10s
            fi
            FORMAT="bestvideo[height<=${QUALITY}]+worstaudio/best=[height<=${QUALITY}]"
            ;;
        *)
            FORMAT='bestvideo[height<="$QUALITY"]+bestaudio/best=[height<="$QUALITY"]'
            ;;
    esac

    ~${3-d} && youtube-dl -R 'infinite' -f $FORMAT $2
    fi
}
